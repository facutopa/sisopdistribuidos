**Ejercicio RPC** 

**Servidor de Direcciones IP**

Siguiendo con nuestra propuesta de construir embriones de servicios, como hemos hecho en la práctica programando un embrión de servidor de procesos y servidor de archivos, hoy intentarán construir un embrión de un Servidor de ip.

**Descripción**

Nuestro Servidor de ip, tendrá que resolver el nombre del host, y devolver la o las ip al cliente.

**Prueba**

Para probar el funcionamiento del servidor de ip, hay que programar utilizando RPC un servidor que reciba un nombre de host desde el cliente y que el servidor le devuelva al cliente la o las ip del host.

El servidor se ejecuta desde la línea de comando de la siguiente forma:

$ ./servidor &

El cliente se ejecuta desde la línea de comando de la siguiente forma:

$ ./ips\_client 127.0.0.1 [www.google.com](http://www.google.com) 

**Ayuda** 

**Esta función permite obtener y muestra las direcciones IP de un nombre de Host**

\#include \<netdb.h>

\#include \<stdio.h>

void funcionip(char \* hostname);

int main(int argc, char \*argv\[]) {

if (argc != 2) {

     printf("Uso: %s \<nombre\_del\_host>\n", argv\[0]);

     return 1;

}

char \*hostname = argv\[1];

funcionip(hostname);

return 0;

}

void funcionip(char \* hostname)

{

    struct in\_addr \*\*addr\_list;

    struct hostent \*he = gethostbyname(hostname);

    if (he)

      { 

        int i;

        puts(he->h\_name);

        printf("Nombre del Host : %s\n", he->h\_name);

        printf(" Direcciones IP  ");

        addr\_list = (struct in\_addr \*\*)he->h\_addr\_list;

        for(i = 0; addr\_list\[i] != NULL; i++)

           {

            printf("%s \n", inet\_ntoa(\*addr\_list\[i]));

          }

        printf("\n");

      }

    else

        printf("error gethostbyname\n");

}

**Implementación**

Se debe implementar utilizando RPC

**Solución** 

**ips.x**

\


struct envia

{

    char dominio\[100] ;

};

struct retorno

{

    char retips\[100] ;

};

program IPS\_PROGRAMA{

    version VERSION\_IPS\_PROGRAMA{

        struct retorno ips (struct envia) = 1;

   }  =  1;

} = 0x20000001;

//grabar ips.x 

//ejecutar rpcgen –a ips.x

**ips\_client.c**

/\*

 \* This is sample code generated by rpcgen.

 \* These are only templates and you can use them

 \* as a guideline for developing your own functions.

 \*/

\#include "ips.h"

\
\


**main.c**

int main (int argc, char \*argv\[])

{

char \*host;

if (argc < 2) {

printf ("usage: %s server\_host dominio\n", argv\[0]);

exit (1);

}

host = argv\[1];

ips\_programa\_1 (host,argv\[2]);

            exit (0);

}

**ips\_server.c**

/\*

 \* This is sample code generated by rpcgen.

 \* These are only templates and you can use them

 \* as a guideline for developing your own functions.

 \*/

\#include "ips.h"

\#include \<netdb.h>

\#include \<string.h>

void funcionip(char \* ,char \[]);

struct retorno \* ips\_1\_svc(struct envia \*argp, struct svc\_req \*rqstp)

{

static struct retorno  result;

            memset(result.retips,0,100);  //agregado

funcionip(argp->dominio,result.retips);  //agregado

return \&result;

}

\


// agregar esta function a ips\_server.c

void funcionip(char \* dominio, char TodasLasIp\[])

{

    struct in\_addr \*\*addr\_list;

    struct hostent \*he = gethostbyname(dominio);

    if (he)

      { 

        int i;

        puts(he->h\_name);

        printf("Servidor Dice Nombre del Host : %s\n", he->h\_name);

        printf("Servidor Dice Direcciones IP  ");

        addr\_list = (struct in\_addr \*\*)he->h\_addr\_list;

        for(i = 0; addr\_list\[i] != NULL; i++)

           {

            printf("%s \n", inet\_ntoa(\*addr\_list\[i]));

            strcat(TodasLasIp,(char\*) inet\_ntoa(\*addr\_list\[i]));

            strcat(TodasLasIp,"\n");

          }

        printf("\n");

      }

    else

     {       

        printf("Servidor dice error gethostbyname\n");

        strcat(TodasLasIp,"error gethostbyname\n");

     }   

}
